{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacao","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","ConnectionFactory","Bind","Negociacao","NegociacaoDAO","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacao","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","importa","length","textToDate","value","getConnection","connection","dao","apagarDados","msg","esvazia","focus","coluna","ordena","a","b","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacao} from '../models/ListaNegociacao';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacoesView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {ConnectionFactory} from '../services/ConnectionFactory';\nimport {Bind} from '../helpers/Bind';\nimport {Negociacao} from '../models/Negociacao';\nimport {NegociacaoDAO} from '../dao/NegociacaoDAO';\n\nexport class NegociacaoController {\n    \n    constructor(){\n        let $ = document.querySelector.bind(document);\n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n\n        this._ordemAtual = '';\n        this._listaNegociacao = new Bind(\n            new ListaNegociacao(),\n            new NegociacoesView($('#negociacoes-view')),\n            'adiciona','esvazia','ordena'\n        );\n        this._mensagem = this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView($('#mensagem-views')),\n            'texto'\n        );\n        this._service = new NegociacaoService();\n        this._init();\n    }\n\n    _init(){\n        this._service\n            .lista()\n            .then(negociacoes => \n                negociacoes.forEach( \n                    negociacao => this._listaNegociacao.adiciona(negociacao)))\n            .catch( erro => this._mensagem.texto = erro);\n        \n        setInterval(()=>\n            this.importaNegociacoes(),\n        3000)\n    }\n\n    adiciona(event){\n        event.preventDefault();\n\n        let negociacao = this._criaNegociacao();\n        \n            this._service\n            .cadastra(negociacao)\n            .then(mensagem => {\n                this._mensagem.texto = mensagem+'';\n                this._listaNegociacao.adiciona(negociacao); \n                this._limpaFormulario();  \n            })\n            .catch(erro => this._mensagem.texto = erro+'');\n    }\n\n    importaNegociacoes(){\n        \n        this._service\n        .importa(this._listaNegociacao.negociacoes)\n        .then(negociacoes => { \n            negociacoes.forEach(negociacao => \n            this._listaNegociacao.adiciona(negociacao));\n            if(negociacoes.length != 0){\n                this._mensagem.texto = 'Negociações do período importadas';\n            }\n        })\n        .catch(erro => this._mensagem.texto = erro)\n    }\n                                                                                                                                                                                        \n    _criaNegociacao(){\n        return new Negociacao(  \n            DateHelper.textToDate(this._inputData.value),\n            this._inputQuantidade.value,\n            this._inputValor.value\n        );\n    }\n\n    apaga(){\n        ConnectionFactory\n            .getConnection()\n            .then( connection => new NegociacaoDAO(connection))\n            .then( dao => dao.apagarDados())\n            .then( msg => { \n                this._mensagem.texto = msg\n                this._listaNegociacao.esvazia()\n            });\n    }\n\n    _limpaFormulario(){\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0;\n        this._inputData.focus();\n    }\n\n    ordena(coluna){\n        if (coluna != this._ordemAtual){\n            this._listaNegociacao.ordena((a, b) => a[coluna] - b[coluna])\n            this._ordemAtual = coluna;\n        } else {\n            this._listaNegociacao.ordena((a, b) => b[coluna] - a[coluna])\n            this._ordemAtual = '';\n        }\n    }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance(){\n    return negociacaoController;\n}"]}