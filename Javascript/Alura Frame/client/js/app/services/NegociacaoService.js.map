{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDAO","Negociacao","NegociacaoService","_http","Promise","resolve","reject","get","then","negociacoes","catch","console","log","erro","all","obterNegociacoesSemana","obterNegociacoesSemanaAnterior","obterNegociacoesSemanaRetrasada","arrayNego","arrayNegociacoes","forEach","periodos","push","negociacao","Error","getConnection","connection","dao","adicionar","listaTodos","listaAtual","obterAllNegociacoes","filter","some","JSON","stringify","negociacaoExistente"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\nimport {ConnectionFactory} from './ConnectionFactory';\nimport {NegociacaoDAO} from '../dao/NegociacaoDAO';\nimport {Negociacao} from '../models/Negociacao';\n\nexport class NegociacaoService {\n    constructor(){\n        this._http = new HttpService();\n    }\n    obterNegociacoesSemana(){\n        return new Promise((resolve,reject)=>{\n            this._http.get('http://localhost:3000/negociacoes/semana')\n            .then(negociacoes => \n                resolve(negociacoes)\n            )\n            .catch(erro => {\n                    console.log(erro);\n                    reject('Não foi possível obter as negociacoes da semana')\n                }\n            );\n        })\n    }\n    obterNegociacoesSemanaRetrasada(){\n        return new Promise((resolve,reject)=>{\n            this._http.get('http://localhost:3000/negociacoes/retrasada')\n            .then(negociacoes => \n                resolve(negociacoes)\n            )\n            .catch(erro => {\n                    console.log(erro);\n                    reject('Não foi possível obter as negociacoes da semana')\n                }\n            );\n        })\n    }\n    obterNegociacoesSemanaAnterior(){\n        return new Promise((resolve,reject)=>{\n            this._http.get('http://localhost:3000/negociacoes/anterior')\n            .then(negociacoes => \n                resolve(negociacoes)\n            )\n            .catch(erro => {\n                    console.log(erro);\n                    reject('Não foi possível obter as negociacoes da semana')\n                }\n            );\n        })\n    }\n\n    obterAllNegociacoes(){\n        return Promise.all([\n            this.obterNegociacoesSemana(),\n            this.obterNegociacoesSemanaAnterior(),\n            this.obterNegociacoesSemanaRetrasada()\n        ]).then(arrayNegociacoes => {\n            let arrayNego = [];\n                arrayNegociacoes\n                .forEach(periodos => {\n                    periodos.forEach( negociacao => arrayNego.push(negociacao) )\n                })\n                return arrayNego;\n            })\n            .catch(erro => { throw new Error(erro) });\n    }\n    cadastra(negociacao){\n        return ConnectionFactory\n                .getConnection()\n                .then(connection => new NegociacaoDAO(connection))\n                .then(dao => dao.adicionar(negociacao))\n                .then(()=>'Negociação cadastrada com sucesso')\n                .catch(()=>\"Não foi possível adicionar a negociação\");  \n    }\n    lista(){\n        return ConnectionFactory\n            .getConnection()\n            .then(connection => new NegociacaoDAO(connection))\n            .then(dao => dao.listaTodos())\n            .catch(() => console.log('Não foi possível listar'))\n\n    }\n    importa(listaAtual){\n        return this.obterAllNegociacoes()\n            .then( negociacoes => negociacoes.filter( negociacao => \n                !listaAtual.some(negociacaoExistente => \n                        JSON.stringify(negociacao) == JSON.stringify(negociacaoExistente)\n                    )))\n            .catch(erro => {\n                console.log(erro)\n                throw new Error('Não foi possível importar as negociações')\n            })\n    }\n}"]}